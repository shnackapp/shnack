<%= form_for(@order) do |f| %>
  <% if @order.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
      <% @order.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>

  <% end %>

  <div class="the-menu">
  <%= f.hidden_field :user_id, :value => user_signed_in? ? current_user.id : 0 %>
  <%= @owner.instance_of?(Restaurant) ?  f.hidden_field(:restaurant_id, :value => @owner.id) : f.hidden_field(:vendor_id, :value => @owner.id) %>
  <%= f.hidden_field :subtotal, :value => "0" %>

    <% if @menu.categories.count > 1 %>

      <% @menu.categories.each do |category| %>
        <h3 class="SSS my-panel-heading expandable"><%= category.name %></h3>

        <div class="all-items-wrap">
          <% category.items.each do |item| %>
            <div class="row-new single-item-wrap">
              <div class="column three"> <%= item.name %> </div>
              <div id="<%=item.id%>_price" data-price="<%=item.price%>" class="column two"> <%= Item.integer_to_currency item.price %> </div>

              <% if(item.sold_out) %>
                <div class="column three">Item Sold Out</td>

              <% else %> 
                <div class="column one"> <span class="glyphicon glyphicon-minus minus"></span> </div>
                <div id="<%=item.id%>_num" class="column one num"> 0 </div>
                <div class="column one"> <span class="glyphicon glyphicon-plus plus"></span> </div>
                            
                <%= f.hidden_field "item[#{item.id}]", :value => 0, :class => "item_#{item.id}" %>
              <% end %>

              <% if item.has_description? %>
                <div class="column-mobile four ittem-description"> <%= item.description %> </div>
              <% else %>
                <div class="column-mobile four"></div>
              <% end %>
                            
            </div>

            <% if item.has_mod?; @item = item %>
              <%= render :partial => 'display_mods', :locals => { item: @item } %>
            <% end %>

          <% end %>
        </div> <!-- ENDS ALL ITEMS WRAP -->
      </div>
    <% end %>
    <% else %>
     <div class="order-items">
          <table cellspacing="10" class="table">

          <% @menu.items.each do |item| %>
            <tbody class="menu_item" data-id= "<%= item.id %>" style="border:none;outline:none;">
              <tr>
                <td><%= item.name %></td>
                <td id="<%=item.id%>_price" data-price="<%=item.price%>"><%= Item.integer_to_currency item.price %></td>
                <% if(item.sold_out) %>
                  <td colspan="3">Item Sold Out</td>
                <% else %> 
                                  <td> <span class="glyphicon glyphicon-minus minus"></span> </td>

                  <td id="<%=item.id%>_num" class="num"> 0 </td>
                                    <td> <span class="glyphicon glyphicon-plus plus"></span> </td>

                  <td class="item_id hidden"> <%= item.id %> </td>
                  <%= f.hidden_field "item[#{item.id}]", :value => 0, :class => "item_#{item.id}" %>
             
                  <% if item.has_description? %>
                    </tr>
                    <tr>
                      <td colspan="5" class="item-description"> <%= item.description %> </td>
                  <% end %>
                  <% if item.has_mod?; @item = item %>
                    <%= render :partial => 'display_mods', :locals => { item: @item } %>
                  <% end %>
                <% end %>
              </tr>


            </tbody>
          <%end%>
        </table>
      </div>
    <% end %>


    <table class="table subtotal" style="margin-bottom:2em;">
      <tr>
        <td>Subtotal: </td>
        <td></td>
        <td class="subtotal text-center" data-total="000" colspan="3"> $0.00</td>
      </tr>
      <% if @owner.shnack_fee != 0 %>
      <tr>
        <td> Shnack Fee: </td>
        <td></td>
        <td class="fee text-center" data-price="<%= @owner.shnack_fee %>" colspan="3"> <%= @order.integer_to_currency(@owner.shnack_fee) %></td>
      </tr>
      <% end %>
      <tr>
        <td> Total </td>
        <td></td>
        <td class="total text-center" data-total="000" colspan="3"> $0.00 </td>
      </tr>
    </table>
  </div>

  <div class="actions">
  <% if @owner.is_open? %>
    <%= button_tag(type: 'submit', id:"order-submit", class: "push-btn darkslategray") do %>
      <i class="fa fa-cutlery pad-right-sml"></i> Next
    <% end %>
  <% else %> 
    <%= button_tag(type: 'submit', id:"order-submit",  class: "push-btn", :disabled => true) do %>
      <i class="fa fa-frown-o pad-right-sml"></i> Currently Closed
    <% end %>
  </div>
  <% end %>
<% end %>


